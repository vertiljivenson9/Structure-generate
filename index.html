<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generator Structure - Crea estructuras de proyectos</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <style>
        /* Reset y estilos base */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: #2563eb;
            --primary-dark: #1d4ed8;
            --secondary-color: #10b981;
            --text-primary: #1f2937;
            --text-secondary: #6b7280;
            --text-light: #9ca3af;
            --bg-white: #ffffff;
            --bg-gray: #f9fafb;
            --border-color: #e5e7eb;
            --error-color: #ef4444;
            --success-color: #10b981;
            --shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --radius: 8px;
            --radius-lg: 12px;
        }

        body {
            font-family: 'Inter', sans-serif;
            color: var(--text-primary);
            background-color: var(--bg-white);
            line-height: 1.5;
            min-height: 100vh;
        }

        /* Layout principal */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Cabecera */
        header {
            padding: 24px 0;
            border-bottom: 1px solid var(--border-color);
            background-color: var(--bg-white);
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .header-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            text-decoration: none;
        }

        .logo-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            border-radius: var(--radius);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            font-size: 18px;
        }

        .logo-text {
            font-size: 24px;
            font-weight: 700;
            color: var(--text-primary);
        }

        .tagline {
            font-size: 14px;
            color: var(--text-secondary);
            margin-top: 4px;
        }

        /* Contenido principal */
        .main-content {
            padding: 40px 0 60px;
            display: grid;
            grid-template-columns: 1fr;
            gap: 40px;
        }

        @media (min-width: 992px) {
            .main-content {
                grid-template-columns: 1fr 1fr;
            }
        }

        /* Paneles */
        .panel {
            background-color: var(--bg-white);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow);
            padding: 32px;
            height: fit-content;
        }

        .panel-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 24px;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .panel-title svg {
            color: var(--primary-color);
        }

        /* Formulario y controles */
        .form-group {
            margin-bottom: 24px;
        }

        .form-label {
            display: block;
            font-size: 14px;
            font-weight: 500;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .form-control {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid var(--border-color);
            border-radius: var(--radius);
            font-family: 'Inter', sans-serif;
            font-size: 15px;
            transition: all 0.2s;
            background-color: var(--bg-white);
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        textarea.form-control {
            min-height: 180px;
            resize: vertical;
        }

        .form-hint {
            font-size: 13px;
            color: var(--text-light);
            margin-top: 6px;
        }

        .api-key-container {
            position: relative;
        }

        .api-key-toggle {
            position: absolute;
            right: 12px;
            top: 12px;
            background: none;
            border: none;
            color: var(--text-light);
            cursor: pointer;
            font-size: 14px;
        }

        /* Botones */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 14px 24px;
            font-family: 'Inter', sans-serif;
            font-size: 16px;
            font-weight: 600;
            border-radius: var(--radius);
            border: none;
            cursor: pointer;
            transition: all 0.2s;
            text-decoration: none;
            width: 100%;
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background-color: var(--primary-dark);
            transform: translateY(-1px);
            box-shadow: var(--shadow-lg);
        }

        .btn-primary:disabled {
            background-color: var(--text-light);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .btn-secondary {
            background-color: var(--bg-gray);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }

        .btn-secondary:hover {
            background-color: #e5e7eb;
        }

        .btn-secondary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-icon {
            width: 20px;
            height: 20px;
        }

        /* Panel de vista previa */
        .preview-container {
            margin-top: 20px;
            border: 1px solid var(--border-color);
            border-radius: var(--radius);
            overflow: hidden;
            max-height: 400px;
            overflow-y: auto;
        }

        .preview-header {
            padding: 16px;
            background-color: var(--bg-gray);
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .preview-title {
            font-weight: 600;
            font-size: 15px;
        }

        .preview-placeholder {
            padding: 40px 20px;
            text-align: center;
            color: var(--text-light);
        }

        .preview-placeholder svg {
            margin-bottom: 16px;
            color: var(--border-color);
        }

        /* Árbol de archivos */
        .file-tree {
            padding: 16px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
        }

        .tree-item {
            padding: 4px 0;
            display: flex;
            align-items: center;
        }

        .tree-item.folder {
            font-weight: 600;
            color: var(--primary-color);
        }

        .tree-item.file {
            color: var(--text-secondary);
        }

        .tree-indent {
            display: inline-block;
            width: 20px;
        }

        .tree-icon {
            margin-right: 8px;
            width: 16px;
            height: 16px;
        }

        /* Estados y notificaciones */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .message {
            padding: 16px;
            border-radius: var(--radius);
            margin-bottom: 24px;
            font-size: 15px;
            display: flex;
            align-items: flex-start;
            gap: 12px;
        }

        .message-info {
            background-color: #eff6ff;
            color: var(--primary-color);
            border-left: 4px solid var(--primary-color);
        }

        .message-error {
            background-color: #fef2f2;
            color: var(--error-color);
            border-left: 4px solid var(--error-color);
        }

        .message-success {
            background-color: #ecfdf5;
            color: var(--success-color);
            border-left: 4px solid var(--success-color);
        }

        .message-icon {
            flex-shrink: 0;
            margin-top: 2px;
        }

        .hidden {
            display: none !important;
        }

        /* Footer */
        footer {
            padding: 24px 0;
            border-top: 1px solid var(--border-color);
            text-align: center;
            color: var(--text-light);
            font-size: 14px;
        }

        .footer-links {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 12px;
        }

        .footer-link {
            color: var(--text-secondary);
            text-decoration: none;
            transition: color 0.2s;
        }

        .footer-link:hover {
            color: var(--primary-color);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .panel {
                padding: 24px;
            }
            
            .header-content {
                flex-direction: column;
                gap: 16px;
                align-items: flex-start;
            }
            
            .main-content {
                padding: 24px 0 40px;
                gap: 24px;
            }
            
            .btn {
                padding: 12px 20px;
            }
        }

        /* Ejemplos */
        .examples {
            margin-top: 24px;
            border-top: 1px solid var(--border-color);
            padding-top: 20px;
        }

        .examples-title {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 12px;
            color: var(--text-secondary);
        }

        .example-item {
            background-color: var(--bg-gray);
            border-radius: var(--radius);
            padding: 12px;
            margin-bottom: 12px;
            cursor: pointer;
            transition: background-color 0.2s;
            font-size: 14px;
        }

        .example-item:hover {
            background-color: #e5e7eb;
        }

        .example-item:last-child {
            margin-bottom: 0;
        }

        /* Controles de acción */
        .action-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
            margin-top: 32px;
        }

        .divider {
            height: 1px;
            background-color: var(--border-color);
            margin: 24px 0;
        }
    </style>
</head>
<body>
    <!-- Cabecera -->
    <header>
        <div class="container">
            <div class="header-content">
                <a href="#" class="logo">
                    <div class="logo-icon">GS</div>
                    <div>
                        <div class="logo-text">Generator Structure</div>
                        <div class="tagline">Transforma descripciones en estructuras de proyectos</div>
                    </div>
                </a>
            </div>
        </div>
    </header>

    <!-- Contenido principal -->
    <main class="container">
        <div class="main-content">
            <!-- Panel de entrada -->
            <div class="panel">
                <h2 class="panel-title">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                        <polyline points="14 2 14 8 20 8"></polyline>
                        <line x1="16" y1="13" x2="8" x2="13" y2="13"></line>
                        <line x1="16" y1="17" x2="8" y2="17"></line>
                        <polyline points="10 9 9 9 8 9"></polyline>
                    </svg>
                    Configura tu proyecto
                </h2>
                
                <div id="message-container"></div>
                
                <div class="form-group">
                    <label for="api-key" class="form-label">Tu API Key de OpenAI</label>
                    <div class="api-key-container">
                        <input type="password" id="api-key" class="form-control" placeholder="sk-...">
                        <button type="button" id="toggle-api-key" class="api-key-toggle">Mostrar</button>
                    </div>
                    <div class="form-hint">
                        Tu API key no se almacena ni se envía a nuestros servidores. Se utiliza únicamente para generar la estructura.
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="project-description" class="form-label">Descripción del proyecto</label>
                    <textarea 
                        id="project-description" 
                        class="form-control" 
                        placeholder="Ejemplo: Crea la estructura para una aplicación web con React, TypeScript, y Tailwind CSS. Incluye componentes principales (Header, Footer, Dashboard), páginas (Home, About, Contact) y utilidades (hooks, helpers)."
                    ></textarea>
                    <div class="form-hint">
                        Describe tu proyecto en lenguaje natural. Sé tan detallado como desees.
                    </div>
                </div>
                
                <button id="generate-btn" class="btn btn-primary">
                    <svg class="btn-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                        <polyline points="7 10 12 15 17 10"></polyline>
                        <line x1="12" y1="15" x2="12" y2="3"></line>
                    </svg>
                    Generar estructura
                </button>
                
                <div class="examples">
                    <div class="examples-title">Ejemplos rápidos:</div>
                    <div class="example-item" data-example="react">Aplicación React con TypeScript y estructura modular</div>
                    <div class="example-item" data-example="node">API REST con Node.js, Express y estructura de carpetas MVC</div>
                    <div class="example-item" data-example="python">Proyecto Python con paquetes, tests y documentación</div>
                </div>
            </div>
            
            <!-- Panel de vista previa -->
            <div class="panel">
                <h2 class="panel-title">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <polyline points="16 18 22 12 16 6"></polyline>
                        <polyline points="8 6 2 12 8 18"></polyline>
                    </svg>
                    Vista previa del proyecto
                </h2>
                
                <div class="preview-container">
                    <div id="preview-placeholder" class="preview-placeholder">
                        <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path>
                            <line x1="12" y1="11" x2="12" y2="17"></line>
                            <line x1="9" y1="14" x2="15" y2="14"></line>
                        </svg>
                        <p>La estructura generada aparecerá aquí</p>
                    </div>
                    <div id="preview-content" class="hidden">
                        <div class="preview-header">
                            <div class="preview-title">Estructura del proyecto</div>
                            <div id="file-count">0 archivos</div>
                        </div>
                        <div id="file-tree" class="file-tree"></div>
                    </div>
                </div>
                
                <div class="divider"></div>
                
                <div class="action-buttons">
                    <button id="preview-toggle-btn" class="btn btn-secondary" disabled>
                        <svg class="btn-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                            <circle cx="12" cy="12" r="3"></circle>
                        </svg>
                        Alternar vista previa
                    </button>
                    <button id="download-btn" class="btn btn-primary" disabled>
                        <svg class="btn-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                            <polyline points="7 10 12 15 17 10"></polyline>
                            <line x1="12" y1="15" x2="12" y2="3"></line>
                        </svg>
                        Descargar ZIP
                    </button>
                </div>
                
                <div class="form-hint" style="margin-top: 16px;">
                    Nota: Los archivos generados estarán vacíos. Esta herramienta crea solo la estructura de directorios y archivos.
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div>Generator Structure &copy; <span id="current-year">2023</span></div>
            <div class="footer-links">
                <a href="#" class="footer-link">Privacidad</a>
                <a href="#" class="footer-link">Términos</a>
                <a href="#" class="footer-link">Soporte</a>
            </div>
        </div>
    </footer>

    <script>
        // Configuración y estado
        const state = {
            apiKey: '',
            projectStructure: null,
            isPreviewVisible: true
        };

        // Elementos del DOM
        const elements = {
            apiKeyInput: document.getElementById('api-key'),
            toggleApiKeyBtn: document.getElementById('toggle-api-key'),
            projectDescription: document.getElementById('project-description'),
            generateBtn: document.getElementById('generate-btn'),
            previewPlaceholder: document.getElementById('preview-placeholder'),
            previewContent: document.getElementById('preview-content'),
            fileTree: document.getElementById('file-tree'),
            fileCount: document.getElementById('file-count'),
            previewToggleBtn: document.getElementById('preview-toggle-btn'),
            downloadBtn: document.getElementById('download-btn'),
            messageContainer: document.getElementById('message-container'),
            exampleItems: document.querySelectorAll('.example-item')
        };

        // Ejemplos de descripciones
        const examples = {
            react: "Crea la estructura para una aplicación React con TypeScript. Incluye componentes principales (Header, Footer, Sidebar, Dashboard), páginas (Home, About, Contact, Login), hooks personalizados (useAuth, useFetch), servicios para API, utilidades (formateadores, validadores), estilos con Tailwind CSS y configuración de ESLint y Prettier.",
            node: "Crea la estructura para una API REST con Node.js y Express. Incluye modelo MVC con controladores, modelos, rutas y middlewares. Agrega carpetas para configuraciones (base de datos, autenticación), utilidades (validadores, helpers), tests con Jest y documentación con Swagger.",
            python: "Crea la estructura para un proyecto Python con empaquetado. Incluye módulo principal con subpaquetes (core, utils, models), tests unitarios y de integración, documentación con Sphinx, configuración para setup.py, requirements.txt, y archivos de configuración para CI/CD."
        };

        // Inicialización
        document.addEventListener('DOMContentLoaded', function() {
            initApp();
        });

        function initApp() {
            // Establecer año actual en el footer
            document.getElementById('current-year').textContent = new Date().getFullYear();
            
            // Configurar event listeners
            elements.toggleApiKeyBtn.addEventListener('click', toggleApiKeyVisibility);
            elements.generateBtn.addEventListener('click', generateStructure);
            elements.previewToggleBtn.addEventListener('click', togglePreview);
            elements.downloadBtn.addEventListener('click', downloadZip);
            
            // Configurar ejemplos
            elements.exampleItems.forEach(item => {
                item.addEventListener('click', function() {
                    const exampleType = this.getAttribute('data-example');
                    elements.projectDescription.value = examples[exampleType];
                    showMessage('Ejemplo cargado. Ahora haz clic en "Generar estructura".', 'info');
                });
            });
            
            // Validar entradas en tiempo real
            elements.apiKeyInput.addEventListener('input', validateInputs);
            elements.projectDescription.addEventListener('input', validateInputs);
            
            // Estado inicial
            validateInputs();
        }

        // Funciones de utilidad
        function toggleApiKeyVisibility() {
            const type = elements.apiKeyInput.getAttribute('type');
            if (type === 'password') {
                elements.apiKeyInput.setAttribute('type', 'text');
                elements.toggleApiKeyBtn.textContent = 'Ocultar';
            } else {
                elements.apiKeyInput.setAttribute('type', 'password');
                elements.toggleApiKeyBtn.textContent = 'Mostrar';
            }
        }

        function validateInputs() {
            const apiKey = elements.apiKeyInput.value.trim();
            const description = elements.projectDescription.value.trim();
            
            // Validar formato de API Key (empieza con "sk-")
            const isApiKeyValid = apiKey.length > 10 && apiKey.startsWith('sk-');
            const isDescriptionValid = description.length > 20;
            
            elements.generateBtn.disabled = !(isApiKeyValid && isDescriptionValid);
            
            // Actualizar estado
            state.apiKey = apiKey;
            
            return isApiKeyValid && isDescriptionValid;
        }

        function showMessage(text, type = 'info') {
            // Eliminar mensajes anteriores
            while (elements.messageContainer.firstChild) {
                elements.messageContainer.removeChild(elements.messageContainer.firstChild);
            }
            
            if (!text) return;
            
            const message = document.createElement('div');
            message.className = `message message-${type}`;
            
            let iconPath = '';
            switch(type) {
                case 'error':
                    iconPath = 'M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z';
                    break;
                case 'success':
                    iconPath = 'M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z';
                    break;
                default:
                    iconPath = 'M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z';
            }
            
            message.innerHTML = `
                <svg class="message-icon" width="20" height="20" viewBox="0 0 24 24">
                    <path d="${iconPath}" fill="currentColor"/>
                </svg>
                <div>${text}</div>
            `;
            
            elements.messageContainer.appendChild(message);
            
            // Auto-eliminar mensajes después de 5 segundos (excepto errores)
            if (type !== 'error') {
                setTimeout(() => {
                    if (message.parentNode) {
                        message.parentNode.removeChild(message);
                    }
                }, 5000);
            }
        }

        // Funcionalidad principal
        async function generateStructure() {
            if (!validateInputs()) {
                showMessage('Por favor, ingresa una API Key válida y una descripción detallada del proyecto.', 'error');
                return;
            }
            
            // Mostrar estado de carga
            elements.generateBtn.innerHTML = '<div class="loading"></div> Generando...';
            elements.generateBtn.disabled = true;
            
            showMessage('Generando estructura del proyecto. Esto puede tomar unos segundos...', 'info');
            
            try {
                const description = elements.projectDescription.value.trim();
                const structure = await callOpenAI(description);
                
                if (structure && structure.files) {
                    state.projectStructure = structure;
                    renderFileTree(structure);
                    enableDownload();
                    showMessage('Estructura generada correctamente. Ahora puedes descargar el ZIP.', 'success');
                } else {
                    throw new Error('La respuesta de OpenAI no contiene una estructura válida.');
                }
            } catch (error) {
                console.error('Error generando estructura:', error);
                showMessage(`Error: ${error.message || 'No se pudo generar la estructura. Verifica tu API Key e intenta nuevamente.'}`, 'error');
            } finally {
                // Restaurar botón
                elements.generateBtn.innerHTML = `
                    <svg class="btn-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                        <polyline points="7 10 12 15 17 10"></polyline>
                        <line x1="12" y1="15" x2="12" y2="3"></line>
                    </svg>
                    Generar estructura
                `;
                elements.generateBtn.disabled = false;
                validateInputs();
            }
        }

        async function callOpenAI(description) {
            const systemPrompt = `Eres un asistente especializado en estructuras de proyectos de software. 
            Tu tarea es generar un JSON con la estructura de archivos y carpetas para un proyecto basado en la descripción proporcionada.
            
            Reglas:
            1. Devuelve ÚNICAMENTE un objeto JSON válido, sin texto adicional.
            2. El JSON debe tener esta estructura: {"projectName": "nombre", "files": [...]}
            3. Cada elemento en "files" debe ser un objeto con: 
               - "name": nombre del archivo o carpeta
               - "type": "file" o "folder"
               - Si es un folder, incluye "children": [] con sus contenidos
               - Si es un file, incluye "extension": la extensión adecuada
            
            Ejemplo de respuesta:
            {
                "projectName": "mi-proyecto",
                "files": [
                    {"name": "src", "type": "folder", "children": [
                        {"name": "index.js", "type": "file", "extension": ".js"}
                    ]},
                    {"name": "package.json", "type": "file", "extension": ".json"}
                ]
            }
            
            Consideraciones:
            - Incluye solo archivos esenciales para la estructura básica
            - Los archivos deben estar vacíos (solo necesitamos la estructura)
            - Usa nombres de carpetas y archivos estándar para el tipo de proyecto
            - Incluye archivos de configuración comunes (como .gitignore, README.md, etc.)`;
            
            const userPrompt = `Descripción del proyecto: ${description}`;
            
            try {
                const response = await fetch('https://api.openai.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${state.apiKey}`
                    },
                    body: JSON.stringify({
                        model: 'gpt-3.5-turbo',
                        messages: [
                            { role: 'system', content: systemPrompt },
                            { role: 'user', content: userPrompt }
                        ],
                        temperature: 0.3,
                        max_tokens: 1500
                    })
                });
                
                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error?.message || `Error HTTP: ${response.status}`);
                }
                
                const data = await response.json();
                const content = data.choices[0].message.content.trim();
                
                // Extraer JSON de la respuesta (por si acaso OpenAI agrega texto adicional)
                const jsonMatch = content.match(/\{[\s\S]*\}/);
                if (!jsonMatch) {
                    throw new Error('No se encontró JSON en la respuesta');
                }
                
                return JSON.parse(jsonMatch[0]);
            } catch (error) {
                throw error;
            }
        }

        function renderFileTree(structure) {
            elements.fileTree.innerHTML = '';
            elements.previewPlaceholder.classList.add('hidden');
            elements.previewContent.classList.remove('hidden');
            
            let fileCount = 0;
            
            // Función recursiva para renderizar elementos
            function renderItems(items, indent = 0) {
                items.forEach(item => {
                    const div = document.createElement('div');
                    div.className = `tree-item ${item.type}`;
                    
                    // Icono según tipo
                    let icon = '';
                    if (item.type === 'folder') {
                        icon = '<svg class="tree-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path></svg>';
                    } else {
                        icon = '<svg class="tree-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline></svg>';
                        fileCount++;
                    }
                    
                    // Sangría
                    let indentHtml = '';
                    for (let i = 0; i < indent; i++) {
                        indentHtml += '<span class="tree-indent"></span>';
                    }
                    
                    // Nombre completo
                    const fullName = item.extension ? `${item.name}${item.extension}` : item.name;
                    
                    div.innerHTML = `${indentHtml}${icon}${fullName}`;
                    elements.fileTree.appendChild(div);
                    
                    // Si es carpeta y tiene hijos, renderizarlos
                    if (item.type === 'folder' && item.children) {
                        renderItems(item.children, indent + 1);
                    }
                });
            }
            
            renderItems(structure.files);
            
            // Actualizar contador
            elements.fileCount.textContent = `${fileCount} archivos`;
            
            // Asegurar que la vista previa sea visible
            state.isPreviewVisible = true;
            elements.previewContainer.style.maxHeight = '400px';
        }

        function togglePreview() {
            state.isPreviewVisible = !state.isPreviewVisible;
            
            if (state.isPreviewVisible) {
                elements.previewContainer.style.maxHeight = '400px';
                elements.previewToggleBtn.innerHTML = `
                    <svg class="btn-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                        <circle cx="12" cy="12" r="3"></circle>
                    </svg>
                    Ocultar vista previa
                `;
            } else {
                elements.previewContainer.style.maxHeight = '0';
                elements.previewToggleBtn.innerHTML = `
                    <svg class="btn-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"></path>
                        <line x1="1" y1="1" x2="23" y2="23"></line>
                    </svg>
                    Mostrar vista previa
                `;
            }
        }

        function enableDownload() {
            elements.downloadBtn.disabled = false;
            elements.previewToggleBtn.disabled = false;
        }

        function downloadZip() {
            if (!state.projectStructure) {
                showMessage('No hay estructura para descargar. Genera una estructura primero.', 'error');
                return;
            }
            
            showMessage('Creando archivo ZIP...', 'info');
            
            try {
                const zip = new JSZip();
                const projectName = state.projectStructure.projectName || 'mi-proyecto';
                
                // Función recursiva para agregar archivos y carpetas al ZIP
                function addItemsToZip(items, zipFolder) {
                    items.forEach(item => {
                        const fullName = item.extension ? `${item.name}${item.extension}` : item.name;
                        
                        if (item.type === 'folder') {
                            const newFolder = zipFolder.folder(fullName);
                            if (item.children) {
                                addItemsToZip(item.children, newFolder);
                            }
                        } else {
                            // Crear archivo vacío
                            zipFolder.file(fullName, '');
                        }
                    });
                }
                
                addItemsToZip(state.projectStructure.files, zip);
                
                // Generar ZIP
                zip.generateAsync({ type: 'blob' })
                    .then(function(content) {
                        saveAs(content, `${projectName}.zip`);
                        showMessage(`ZIP "${projectName}.zip" descargado correctamente.`, 'success');
                    })
                    .catch(function(error) {
                        console.error('Error generando ZIP:', error);
                        showMessage('Error al crear el archivo ZIP.', 'error');
                    });
                    
            } catch (error) {
                console.error('Error preparando ZIP:', error);
                showMessage('Error al preparar la descarga.', 'error');
            }
        }
    </script>
</body>
</html>
